<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="brand" href="/">我们的故事</a>
      <div class="nav-collapse collapse">
        <% if user_signed_in? %>
            <p class="navbar-text pull-right">
              您好，<%= link_to current_user.email, edit_user_registration_path %>
            </p>
        <% end %>
        <ul class="nav">
          <li class="active"><a href="/">管理故事</a></li>
          <li><a href="/storys">我的故事</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div class="container marketing stories">
  <% @events.each_with_index do |event, index| %>
      <div class="featurette">
        <img class="featurette-image pull-<%= index % 2 == 0 ? "right":"left" %>" src="<%= event.img_url %>">
        <h2 class="featurette-heading">
          <%= link_to event.name, event %>
          <span class="muted"><%= event.left_to_s %></span>
        </h2>
        <p class="lead"><strong><%= event.effect_at %></strong><%= event.description %></p>
      </div>
      <div class="pull-right controls-actions">
          <%= link_to '编辑', edit_event_path(event), :class => 'btn btn-large btn-info' %>
          <%= link_to '删除', delete_url(event), :class => 'btn btn-large btn-danger' %>
      </div>
      <hr class="featurette-divider">
  <% end %>
</div><!-- /.container -->

<div class="container">
  <a href="<%= new_event_path %>" class="btn btn-success btn-large btn-block"><i class="icon-plus"></i></a>
</div>

<script>
    $(function() {
        new qq.FileUploader({
            element: document.getElementById('file-uploader-snapshot'),
            action: '/file/upload',
            inputName: 'snapshot',
            debug: true,
            forceMultipart: true,
            uploadButtonText: "上传截图",
            onComplete: function(id, fileName, responseJSON) {
                if (responseJSON.success) {
                    var snapshot = responseJSON.data;
                    for(var i=0;i<10;i++){
                        if($("#screenshot-"+i).attr("hasUp") == "false"){
                            $("#screenshot-img-"+i).attr("src", "/manage/admin/upload/tmp?name="+snapshot);
                            $("#snapshot"+i).val(snapshot);
                            $("#del-"+i).toggle();
                            $("#screenshot-"+i).attr("hasUp","true");
                            break;
                        }
                    }
                } else {
                    alert(responseJSON.message);
                }
            }
        });

        // 图片删除，动态绑定
        $('#thumb a[id^="del-"]').click(function(evt){
            var i = evt.target.id.match(/\d+/)[0];
            $("#screenshot-img-"+i).attr("src", "/manage/images/thumb.png");
            $("#snapshot"+i).val("");
            $("#del-"+i).toggle();
            $("#screenshot-"+i).attr("hasUp","false");
            return false;
        });
    });
</script>